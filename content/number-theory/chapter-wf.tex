\chapter{Number theory}

\section{Modular arithmetic}
	\kactlimport{modular-arithmetic.h}
	% \kactlimport{pairnum-template.h}
	% \kactlimport{preparator.h}
	\kactlimport{mod-inv.h}
	\kactlimport{mod-sum.h}
	\kactlimport{mod-mul.h}
	\kactlimport{mod-sqrt.h}
	% \kactlimport{mul-order.h}
	\kactlimport{mod-range.h}

\section{Primality}
	% https://blog.csdn.net/skywalkert/article/details/50500009
	% https://math.stackexchange.com/questions/316376/how-to-calculate-these-totient-summation-sums-efficiently/579587#579587
	% https://gratus907.com/43
	% https://gratus907.com/108
	% https://blog.sengxian.com/algorithms/mobius-inversion-formula
	% http://robezh.com/2019/10/25/learning-notes-on-multiplicative-functions-dirichlet-convolution-mobius-inversion-etc/
	% https://komsciguy.com/cp/multiplicative-functions/

	% \subsection{Xudyh's Sieve}
 %    $F(n)=\sum_{d\vert n}f(d)$\\
 %    $S(n)=\sum_{i\leq n}f(i)=\sum_{i\leq n}F(i)-\sum_{d=2}^n S\left(\left\lfloor \frac{n}{d}\right\rfloor\right)$ \\
 %    \text{Preprocess $S(1)$ to $S(M)$\hspace{0.1cm}(Set $M=n^{\frac{2}{3}}$ for complexity)} \\
 %    $S(n)=\sum f(i) = \sum_{i\leq n}\left[F(i)-\sum_{j|i,j\neq i}f(j)\right]=\sum F(i) - \sum_{i/j=d=2}^n\sum_{dj\leq n}f(j)$ \\
 %    $S(n)=\sum if(i) = \sum_{i\leq n}i\left[F(i)-\sum_{j|i,j\neq i}f(j)\right]=\sum iF(i) - \sum_{i/j=d=2}^n\sum_{dj\leq n}djf(j)$ \\
 %    $\sum_{d\vert n}\varphi (d)=n\hspace{0.1cm}\sum_{d\vert n}\mu (d)=\text{if } (n > 1) \text{ then } 0 \text{ else } 1\hspace{0.1cm}\sum_{d\vert n}(\mu (\frac{n}{d})\sum_{e\vert d}f(e))=f(n)$ \\
	\kactlimport{sieve.h}
	% \kactlimport{segmented-sieve.h}
	\kactlimport{miller-rabin.h}
	\kactlimport{pollard-rho.h}

\section{Divisibility}
	\kactlimport{extended-euclid.h}
	\kactlimport{division-lemma.h}
	% \kactlimport{prime-factors.h}
	\kactlimport{divisors.h}
	% \kactlimport{num-div.h}
	% \kactlimport{sum-div.h}
	\kactlimport{phi-function.h}
	\kactlimport{discrete-log.h}
	% \kactlimport{primitive-roots.h}
	\kactlimport{prime-counting.h}

\section{Chinese remainder theorem}
	\kactlimport{chinese-remainder.h}

\section{Fractions}
	\kactlimport{fractions.h}
	\kactlimport{continued-fractions.h}
	\kactlimport{frac-binary-search.h}

\subsection{BÃ©zout's identity}
For $a \neq $, $b \neq 0$, then $d=gcd(a,b)$ is the smallest positive integer for which there are integer solutions to
$$ax+by=d$$
If $(x,y)$ is one solution, then all solutions are given by
$$\left(x+\frac{kb}{\gcd(a,b)}, y-\frac{ka}{\gcd(a,b)}\right), \quad k\in\mathbb{Z}$$



\subsection{Pythagorean Triples}
 The Pythagorean triples are uniquely generated by
 \[ a=k\cdot (m^{2}-n^{2}),\ \,b=k\cdot (2mn),\ \,c=k\cdot (m^{2}+n^{2}), \]
 with $m > n > 0$, $k > 0$, $m \bot n$, and either $m$ or $n$ even.



%\subsection{Primitive Roots}
%	It only exists when $n$ is $2, 4, p^k, 2p^k$, where $p$ odd prime.
%	If $g$ is a primitive root, all primitive roots are of the form $g^k$
%	where $k,\phi(p)$ are coprime (hence there are $\phi(\phi(p))$ primitive roots).



%\subsection{Chicken McNugget theorem}
%	Let $x$ and $y$ be two coprime integers, the greater integer that can't be written in the form of $ax + by$ is $\frac{(x-1)(y-1)}{2}$



\section{Primes}
	$p=962592769$ is such that $2^{21} \mid p-1$, which may be useful. For hashing
	use 970592641 (31-bit number), 31443539979727 (45-bit), 3006703054056749
	(52-bit). There are 78498 primes less than 1\,000\,000.

	Primitive roots exist modulo any prime power $p^a$, except for $p = 2, a > 2$, and there are $\phi(\phi(p^a))$ many.
	For $p = 2, a > 2$, the group $\mathbb Z_{2^a}^\times$ is instead isomorphic to $\mathbb Z_2 \times \mathbb Z_{2^{a-2}}$.

%\subsection{Wilson's theorem}
%Let~$n > 1$. Then~$n|(n-1)!+1$ iff~$n$ is prime.


%\subsection{Wolstenholme's theorem}
%Let~$p > 3$ be a prime number. Then its numerator $ 1 + \frac{1}{2}+\frac{1}{3}+\cdots+\frac{1}{p-1} $
%is divisible by~$p^2$.

\subsection{Prime counting function ($\pi(x)$)} The prime counting function is asymptotic to $\frac{x}{\log x}$, by the prime number theorem.
      
\resizebox{\columnwidth}{!}{%
     \begin{tabular}{|c|c|c|c|c|c|c|c|c|}
    \hline
      x&10&$10^2$&$10^3$&$10^4$&$10^5$&$10^6$&$10^7$&$10^8$\\ \hline
      $\pi(x)$&4&25&168&1.229&9.592&78.498&664.579&5.761.455\\ \hline
  \end{tabular}
}
\subsection{Sum of primes} For any multiplicative $f$:
                \[ S(n,p) = S(n, p-1) - f(p) \cdot (S(n/p,p-1) - S(p-1,p-1))\]

\subsection{Moebius Function}
\[
	\mu(n) = \begin{cases} 0 & n \textrm{ is not square free}\\ 1 & n \textrm{ has even number of prime factors}\\ -1 & n \textrm{ has odd number of prime factors}\\\end{cases}
\]
  Moebius Inversion:
  \[ g(n) = \sum_{d|n} f(d) \Leftrightarrow f(n) = \sum_{d|n} \mu(d)g(n/d) \]
  Other useful formulas/forms:

  $ \sum_{d|n} \phi(d) = n $
  
  $\sum_{\substack{i<n\\ \gcd(i,n)=1}} i = n \frac{\phi(n)}{2} $

$ \sum_{a=1}^n \sum_{b=1}^n [ \gcd(a, b) = 1] = \sum_{d=1}^n \mu(d) {\lfloor \frac{n}{d} \rfloor}^2 $

$ \sum_{a=1}^n \sum_{b=1}^n \gcd(a, b) = \sum_{d=1}^n d \sum_{d|x}^n {\lfloor \frac{n}{x} \rfloor}^2 \mu{(\frac{x}{d})} $

$ \sum_{a=1}^n \sum_{b=a}^n \gcd(a, b) = \sum_{d=1}^n \sum_{d|x}^n \phi{(\frac{x}{d})} d $

$ \sum_{a=1}^n \sum_{b=1}^n \text{lcm}(a, b) = \sum_{d=1}^n \mu(d) d  \sum_{d|x}^n x \binom{{\lfloor \frac{n}{x} \rfloor} + 1}{2}^2 $

$ \sum_{a=1}^n \sum_{b=a+1}^n \text{lcm}(a, b) = \sum_{d=1}^n \sum_{d|x \land x>d}^n \phi{(\frac{x}{d})} \frac{x^2}{2d} $

$ \sum_{a \in S} \sum_{b \in S} \gcd(a, b) = \sum_{d=1}^n (\sum_{x|d} \frac{d}{x} \mu(x)) (\sum_{d|v} \text{freq[v]})^2 $

$ \sum\limits_{a \in S} \sum\limits_{b \in S} \text{lcm}(a, b) = \sum_{d=1}^n \frac{1}{d} (\sum_{x|d} x \mu(x)) (\sum_{d|v} v \cdot \text{freq[v]})^2 $

  $ \sum_{d | n} \mu(d) = [ n = 1] $ (very useful)

  $ g(n) = \sum_{n|d} f(d) \Leftrightarrow f(n) = \sum_{n|d} \mu(d/n)g(d)$

 $ g(n) = \sum_{1 \leq m \leq n} f(\left\lfloor\frac{n}{m}\right \rfloor ) \Leftrightarrow f(n) = \sum_{1\leq m\leq n} \mu(m)g(\left\lfloor\frac{n}{m}\right\rfloor)$


\subsection{Dirichlet Convolution} 
	Given a function $f(x)$, let 

	$$(f*g)(x)=\sum_{d|x}g(d)f(x/d)$$

	If the partial sums $s_{f*g}(n),s_g(n)$ can be computed in $O(1)$ and $s_f(1\ldots n^{2/3})$  can be computed in $O\left(n^{2/3}\right)$ then all $s_f\left(\frac{n}{d}\right)$ can as well. Use

	$$s_{f*g}(n)=\sum_{d=1}^ng(d)s_f(n/d).$$ 

	 $$\implies s_f(n)=\frac{s_{f*g}(n)-\sum_{d=2}^ng(d)s_f(n/d)}{g(1)}$$
	\begin{enumerate}
	 \item If $f(x)=\mu(x)$ then $g(x)=1, (f*g)(x)=(x == 1)$, and $s_f(n)=1-\sum_{i=2}^ns_f(n/i)$\\

	 \item If $f(x)=\phi(x)$ then $g(x)=1, (f*g)(x)=x$, and $s_f(n)=\frac{n(n+1)}{2}-\sum_{i=2}^ns_f(n/i)$
  \end{enumerate}
%Given a function $f(x)$, let $(f*g)(x)=\sum_{d|x}g(d)f(x/d)$. If the partial sums $s_{f*g}(n),s_g(n)$ can be computed in $O(1)$ and $s_f(1\ldots n^{2/3})$ can be computed in $O\left(n^{2/3}\right)$ then $s_f(n)$ can as well. Use
%	$$s_{f*g}(n)=\sum_{d=1}^ng(d)s_f(n/d).$$ 
%	\implies s_f(n)=\frac{s_{f*g}(n)-\sum_{d=2}^ng(d)s_f(n/d)}{g(1)}
%	For example, if $f(x)=\phi(x)$ then $g(x)=1, (f*g)(x)=n$, and $s_f(n)=\frac{n(n+1)}{2}-\sum_{i=2}^ns_f(n/i).$

	\kactlimport{dirichlet-convolution.h}
	% https://codeforces.com/blog/entry/54150

	% Let $s(x)=\sum_{i=1}^x\phi(i).$ Then 
	% $$s(n)=\frac{n(n+1)}{2}-\sum_{i=2}^ns\left(\left\lfloor\frac{n}{i}\right\rfloor\right)$$
	% can be computed in faster than $\Theta(n)$.


%\subsection{Estimates}
%\[
%	\sum_{d|n} d = O(n \log \log n)
%\]
%	The number of divisors of $n$ is at most around 100 for $n < 5e4$, 500 for $n < 1e7$, 2000 for $n < 1e10$, 200\,000 for $n < 1e19$.

	

\iffalse
\subsection{Polya Enumeration theorem}
The enumeration theorem employs a multivariate generating function called the cycle index:
$$Z_{G}(t_{1},t_{2},\ldots ,t_{n})={\frac {1}{|G|}}\sum _{g\in G}t_{1}^{j_{1}(g)}t_{2}^{j_{2}(g)}\cdots t_{n}^{j_{n}(g)}\,,$$
where $n$ is the number of elements of $X$ and $j_k(g)$ is the number of $k$-cycles of the group element $g$ as a permutation of $X$.

The theorem states that the generating function F of the number of colored arrangements by weight is given by:
$$F(t)=Z_{G}(f(t),f(t^{2}),f(t^{3}),\ldots ,f(t^{n}))\,,$$
or in the multivariate case:
$$F(t_{1},\ldots )=Z_{G}(f(t_{1},\ldots ),f(t_{1}^{2},\ldots ),f(t_{1}^{3},\ldots ),\ldots ,f(t_{1}^{n},\ldots ))\,.$$

For instance, when seperating the graphs with the number of edges, we let $f(t)=1+t$, and examine the coefficient of $t^i$ for a graph with $i$ edges, and when seperating the necklaces with the number of beads with three different colors, we let $f(x,y,z)=x+y+z$, and examine the coefficient of $x^iy^jz^k$.
\fi
